# JMeter ç§’æ€å‹æµ‹æŒ‡å—

## ğŸ“‹ æµ‹è¯•ç›®æ ‡

éªŒè¯ç§’æ€åŠŸèƒ½åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼š
1. âœ… **è¶…å–é—®é¢˜** - æ˜¯å¦ä¼šè¶…å–ï¼ˆä¹è§‚é”éªŒè¯ï¼‰
2. âœ… **ä¸€äººä¸€å•** - åŒä¸€ç”¨æˆ·æ˜¯å¦èƒ½é‡å¤è´­ä¹°
3. âœ… **æ€§èƒ½æŒ‡æ ‡** - TPSã€å“åº”æ—¶é—´ã€æˆåŠŸç‡
4. âœ… **åº“å­˜ä¸€è‡´æ€§** - æœ€ç»ˆåº“å­˜æ˜¯å¦æ­£ç¡®

---

## ğŸ¯ æµ‹è¯•åœºæ™¯è®¾è®¡

### åœºæ™¯1ï¼šå•ç”¨æˆ·å¹¶å‘æµ‹è¯•ï¼ˆéªŒè¯ä¸€äººä¸€å•ï¼‰
- **ç”¨æˆ·æ•°**ï¼š1ä¸ª
- **å¹¶å‘çº¿ç¨‹**ï¼š100
- **é¢„æœŸç»“æœ**ï¼šåªæœ‰1ä¸ªè®¢å•æˆåŠŸï¼Œå…¶ä»–99ä¸ªå¤±è´¥ï¼ˆæ¯äººé™è´­ä¸€å¼ ï¼‰

### åœºæ™¯2ï¼šå¤šç”¨æˆ·å¹¶å‘æµ‹è¯•ï¼ˆéªŒè¯è¶…å–ï¼‰
- **ç”¨æˆ·æ•°**ï¼š200ä¸ª
- **åº“å­˜æ•°é‡**ï¼š100
- **å¹¶å‘çº¿ç¨‹**ï¼š200
- **é¢„æœŸç»“æœ**ï¼šæˆåŠŸ100ä¸ªè®¢å•ï¼Œå¤±è´¥100ä¸ªï¼Œåº“å­˜ä¸º0

### åœºæ™¯3ï¼šæ€§èƒ½å‹æµ‹
- **ç”¨æˆ·æ•°**ï¼š1000ä¸ª
- **åº“å­˜æ•°é‡**ï¼š1000
- **å¹¶å‘çº¿ç¨‹**ï¼š1000
- **æµ‹è¯•æ—¶é—´**ï¼šæŒç»­å‹æµ‹è§‚å¯ŸTPSå’Œå“åº”æ—¶é—´

---

## ğŸ“¦ å‡†å¤‡å·¥ä½œ

### Step 1: å‡†å¤‡ç§’æ€åˆ¸æ•°æ®

**æ–¹æ³•1ï¼šä½¿ç”¨ Postman æ·»åŠ **

```
POST http://localhost:8081/voucher/seckill

Body (raw JSON):
{
    "shopId": 1,
    "title": "ã€JMeterå‹æµ‹ã€‘100å…ƒä»£é‡‘åˆ¸",
    "subTitle": "å‘¨ä¸€è‡³å‘¨æ—¥å‡å¯ä½¿ç”¨",
    "rules": "å…¨åœºé€šç”¨",
    "payValue": 8000,
    "actualValue": 10000,
    "type": 1,
    "stock": 100,
    "beginTime": "2025-01-01T00:00:00",
    "endTime": "2025-12-31T23:59:59"
}
```

**å“åº”ï¼š**
```json
{
    "success": true,
    "data": 10  // è®°ä½è¿™ä¸ªä¼˜æƒ åˆ¸ID
}
```

**æ–¹æ³•2ï¼šç›´æ¥æ’å…¥æ•°æ®åº“**

```sql
-- 1. æ’å…¥ä¼˜æƒ åˆ¸
INSERT INTO tb_voucher (shop_id, title, sub_title, rules, pay_value, actual_value, type, status, create_time, update_time) 
VALUES (1, 'ã€JMeterå‹æµ‹ã€‘100å…ƒä»£é‡‘åˆ¸', 'å‘¨ä¸€è‡³å‘¨æ—¥å‡å¯ä½¿ç”¨', 'å…¨åœºé€šç”¨', 8000, 10000, 1, 1, NOW(), NOW());

-- 2. è·å–ä¼˜æƒ åˆ¸ID
SELECT LAST_INSERT_ID(); -- å‡è®¾è¿”å› 10

-- 3. æ’å…¥ç§’æ€åˆ¸ä¿¡æ¯
INSERT INTO tb_seckill_voucher (voucher_id, stock, begin_time, end_time, create_time, update_time) 
VALUES (10, 100, '2025-01-01 00:00:00', '2025-12-31 23:59:59', NOW(), NOW());
```

---

### Step 2: å‡†å¤‡æµ‹è¯•ç”¨æˆ·ï¼ˆé‡è¦ï¼ï¼‰

ç”±äºæœ‰**ä¸€äººä¸€å•**é™åˆ¶ï¼Œéœ€è¦å‡†å¤‡å¤šä¸ªæµ‹è¯•ç”¨æˆ·ã€‚

#### æ–¹æ¡ˆ1ï¼šæ‰¹é‡åˆ›å»ºç”¨æˆ·ï¼ˆæ¨èï¼‰

**åˆ›å»ºSQLè„šæœ¬ï¼š**

```sql
-- æ‰¹é‡æ’å…¥200ä¸ªæµ‹è¯•ç”¨æˆ·
INSERT INTO tb_user (phone, password, nick_name, icon, create_time, update_time) 
VALUES 
('13800000001', NULL, 'user_test_001', '', NOW(), NOW()),
('13800000002', NULL, 'user_test_002', '', NOW(), NOW()),
('13800000003', NULL, 'user_test_003', '', NOW(), NOW()),
-- ... ç»§ç»­åˆ°
('13800000200', NULL, 'user_test_200', '', NOW(), NOW());
```

**å¿«é€Ÿç”Ÿæˆè„šæœ¬ï¼ˆPythonï¼‰ï¼š**

```python
# generate_users.py
for i in range(1, 201):
    phone = f"138000{i:05d}"
    nickname = f"user_test_{i:03d}"
    print(f"('{phone}', NULL, '{nickname}', '', NOW(), NOW()),")
```

---

### Step 3: å‡†å¤‡ç”¨æˆ·Token

#### æ–¹æ¡ˆ1ï¼šä½¿ç”¨CSVæ–‡ä»¶ï¼ˆæ¨èï¼‰

**1. æ‰¹é‡è·å–Tokenï¼ˆPythonè„šæœ¬ï¼‰**

```python
# get_tokens.py
import requests
import json

# å‘é€éªŒè¯ç å¹¶ç™»å½•è·å–token
tokens = []
for i in range(1, 201):
    phone = f"138000{i:05d}"
    
    # å‘é€éªŒè¯ç 
    resp1 = requests.post(f"http://localhost:8081/user/code?phone={phone}")
    print(f"å‘é€éªŒè¯ç : {phone}")
    
    # ä»æ§åˆ¶å°å¤åˆ¶éªŒè¯ç ï¼ˆå®é™…ä½¿ç”¨æ—¶å¯ä»¥å›ºå®šéªŒè¯ç æˆ–ä¿®æ”¹ä»£ç é€»è¾‘ï¼‰
    # è¿™é‡Œå‡è®¾ä½ ä¿®æ”¹äº†ä»£ç ï¼Œå›ºå®šéªŒè¯ç ä¸º 123456
    code = "123456"
    
    # ç™»å½•è·å–token
    resp2 = requests.post("http://localhost:8081/user/login",
                         json={"phone": phone, "code": code})
    token = resp2.json()['data']
    tokens.append(f"{phone},{token}")
    print(f"ç™»å½•æˆåŠŸ: {phone} -> {token[:20]}...")

# ä¿å­˜åˆ°CSVæ–‡ä»¶
with open('tokens.csv', 'w') as f:
    f.write("phone,token\n")
    for line in tokens:
        f.write(line + "\n")

print(f"\nç”Ÿæˆå®Œæˆï¼å…± {len(tokens)} ä¸ªç”¨æˆ·token")
```

**2. ç®€åŒ–æ–¹æ¡ˆï¼šæ‰‹åŠ¨åˆ›å»ºtokens.csv**

```csv
phone,token
13800000001,token1-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
13800000002,token2-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
13800000003,token3-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

---

## ğŸš€ JMeter é…ç½®è¯¦è§£

### Step 1: åˆ›å»ºæµ‹è¯•è®¡åˆ’

1. æ‰“å¼€ JMeter
2. å³é”® `Test Plan` â†’ `Add` â†’ `Threads (Users)` â†’ `Thread Group`

**é…ç½®çº¿ç¨‹ç»„ï¼š**

| å‚æ•° | åœºæ™¯1ï¼ˆä¸€äººä¸€å•ï¼‰ | åœºæ™¯2ï¼ˆè¶…å–ï¼‰ | åœºæ™¯3ï¼ˆæ€§èƒ½ï¼‰|
|------|------------------|---------------|-------------|
| Number of Threads | 100 | 200 | 1000 |
| Ramp-up Period | 1 | 1 | 5 |
| Loop Count | 1 | 1 | 1 |

**è¯´æ˜ï¼š**
- `Number of Threads`ï¼šå¹¶å‘ç”¨æˆ·æ•°
- `Ramp-up Period`ï¼šå¤šå°‘ç§’å†…å¯åŠ¨æ‰€æœ‰çº¿ç¨‹ï¼ˆ1ç§’=ç¬é—´å¯åŠ¨ï¼Œæ¨¡æ‹ŸçœŸå®ç§’æ€ï¼‰
- `Loop Count`ï¼šæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œæ¬¡æ•°

---

### Step 2: æ·»åŠ  CSV Data Set Configï¼ˆé‡è¦ï¼ï¼‰

**å³é”® Thread Group â†’ Add â†’ Config Element â†’ CSV Data Set Config**

**é…ç½®ï¼š**
```
Filename: tokens.csv                    # CSVæ–‡ä»¶è·¯å¾„
File Encoding: UTF-8
Variable Names: phone,token             # å˜é‡åï¼ˆä¸CSVåˆ—åå¯¹åº”ï¼‰
Delimiter: ,                            # åˆ†éš”ç¬¦
Recycle on EOF: True                    # æ–‡ä»¶è¯»å®Œåé‡æ–°å¼€å§‹
Stop thread on EOF: False               # æ–‡ä»¶è¯»å®Œä¸åœæ­¢çº¿ç¨‹
Sharing mode: All threads              # æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼ˆé‡è¦ï¼ï¼‰
```

**å…³é”®ç‚¹ï¼š**
- `Sharing mode: All threads` - ç¡®ä¿æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸åŒçš„token
- å¦‚æœåªæµ‹è¯•ä¸€äººä¸€å•ï¼Œå¯ä»¥åªå‡†å¤‡1ä¸ªtokenï¼Œè®¾ç½® `Recycle on EOF: True`

---

### Step 3: æ·»åŠ  HTTP Request

**å³é”® Thread Group â†’ Add â†’ Sampler â†’ HTTP Request**

**é…ç½®ï¼š**
```
Name: ç§’æ€ä¼˜æƒ åˆ¸

Protocol: http
Server Name or IP: localhost
Port Number: 8081
HTTP Request Method: POST
Path: /voucher-order/seckill/10      # 10æ˜¯ä¼˜æƒ åˆ¸IDï¼Œæ”¹æˆä½ çš„

Body Data: ç•™ç©ºï¼ˆPOSTè¯·æ±‚ï¼Œæ— éœ€bodyï¼‰
```

**æ·»åŠ  HTTP Header Managerï¼ˆå¿…é¡»ï¼ï¼‰ï¼š**

å³é”® `HTTP Request` â†’ `Add` â†’ `Config Element` â†’ `HTTP Header Manager`

æ·»åŠ è¯·æ±‚å¤´ï¼š
```
Name: authorization
Value: ${token}                        # ä½¿ç”¨CSVä¸­çš„tokenå˜é‡
```

---

### Step 4: æ·»åŠ ç›‘å¬å™¨ï¼ˆæŸ¥çœ‹ç»“æœï¼‰

å³é”® `Thread Group` â†’ `Add` â†’ `Listener`

**æ¨èæ·»åŠ ä»¥ä¸‹ç›‘å¬å™¨ï¼š**

1. **View Results Tree** - æŸ¥çœ‹æ¯ä¸ªè¯·æ±‚çš„è¯¦ç»†ç»“æœ
2. **Summary Report** - æŸ¥çœ‹æ±‡æ€»ç»Ÿè®¡ï¼ˆTPSã€å“åº”æ—¶é—´ç­‰ï¼‰
3. **Aggregate Report** - æŸ¥çœ‹èšåˆæŠ¥å‘Š
4. **Response Time Graph** - æŸ¥çœ‹å“åº”æ—¶é—´å›¾è¡¨

---

## ğŸ¯ æµ‹è¯•æ‰§è¡Œ

### åœºæ™¯1ï¼šå•ç”¨æˆ·å¹¶å‘ï¼ˆéªŒè¯ä¸€äººä¸€å•ï¼‰

**é…ç½®ï¼š**
```
Thread Group:
  - Number of Threads: 100
  - Ramp-up: 1
  - Loop: 1

CSV Data Set:
  - åªå‡†å¤‡1ä¸ªç”¨æˆ·token
  - Recycle on EOF: True  # æ‰€æœ‰çº¿ç¨‹ä½¿ç”¨åŒä¸€ä¸ªtoken

HTTP Request:
  - Path: /voucher-order/seckill/10
  - Header: authorization = ${token}
```

**æ‰§è¡Œæµ‹è¯•ï¼š**

1. ç‚¹å‡» `è¿è¡Œ` æŒ‰é’®ï¼ˆç»¿è‰²ä¸‰è§’å½¢ï¼‰
2. è§‚å¯Ÿ `View Results Tree`
3. æŸ¥çœ‹ `Summary Report`

**é¢„æœŸç»“æœï¼š**
```
Summary Report:
  - æ€»è¯·æ±‚æ•°: 100
  - æˆåŠŸ: 1     âœ…ï¼ˆç¬¬ä¸€ä¸ªè¯·æ±‚æˆåŠŸï¼‰
  - å¤±è´¥: 99    âœ…ï¼ˆå…¶ä»–è¯·æ±‚è¿”å›"æ¯äººé™è´­ä¸€å¼ ï¼"ï¼‰
  - Error%: 99%
```

**éªŒè¯æ•°æ®åº“ï¼š**
```sql
-- æŸ¥è¯¢è®¢å•æ•°é‡ï¼ˆåº”è¯¥åªæœ‰1æ¡ï¼‰
SELECT COUNT(*) FROM tb_voucher_order WHERE voucher_id = 10;
-- ç»“æœ: 1

-- æŸ¥è¯¢åº“å­˜ï¼ˆåº”è¯¥å‡å°‘1ï¼‰
SELECT stock FROM tb_seckill_voucher WHERE voucher_id = 10;
-- ç»“æœ: 99ï¼ˆåŸæ¥100ï¼‰
```

---

### åœºæ™¯2ï¼šå¤šç”¨æˆ·å¹¶å‘ï¼ˆéªŒè¯è¶…å–ï¼‰

**é…ç½®ï¼š**
```
Thread Group:
  - Number of Threads: 200
  - Ramp-up: 1
  - Loop: 1

CSV Data Set:
  - å‡†å¤‡200ä¸ªç”¨æˆ·token
  - Sharing mode: All threads  # æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸åŒtoken

ç§’æ€åˆ¸:
  - stock: 100  # åº“å­˜è®¾ç½®ä¸º100
```

**æ‰§è¡Œæµ‹è¯•ï¼š**

1. **é‡ç½®æ•°æ®ï¼š**
```sql
-- é‡ç½®åº“å­˜
UPDATE tb_seckill_voucher SET stock = 100 WHERE voucher_id = 10;

-- åˆ é™¤æµ‹è¯•è®¢å•
DELETE FROM tb_voucher_order WHERE voucher_id = 10;
```

2. **è¿è¡Œ JMeter**

3. **è§‚å¯Ÿç»“æœ**

**é¢„æœŸç»“æœï¼š**
```
Summary Report:
  - æ€»è¯·æ±‚æ•°: 200
  - æˆåŠŸ: 100    âœ…ï¼ˆåº“å­˜ä¸º100ï¼ŒæˆåŠŸ100ä¸ªï¼‰
  - å¤±è´¥: 100    âœ…ï¼ˆåº“å­˜ä¸è¶³ï¼Œå¤±è´¥100ä¸ªï¼‰
  - Error%: 50%
```

**éªŒè¯æ•°æ®åº“ï¼ˆå…³é”®ï¼ï¼‰ï¼š**
```sql
-- æŸ¥è¯¢è®¢å•æ•°é‡
SELECT COUNT(*) FROM tb_voucher_order WHERE voucher_id = 10;
-- ç»“æœ: 100  âœ…ï¼ˆæ­£å¥½100ï¼Œæ²¡æœ‰è¶…å–ï¼‰

-- æŸ¥è¯¢åº“å­˜
SELECT stock FROM tb_seckill_voucher WHERE voucher_id = 10;
-- ç»“æœ: 0  âœ…ï¼ˆåº“å­˜ä¸º0ï¼‰

-- æ£€æŸ¥æ˜¯å¦æœ‰è¶…å–ï¼ˆåº“å­˜ä¸ºè´Ÿï¼‰
SELECT * FROM tb_seckill_voucher WHERE voucher_id = 10 AND stock < 0;
-- ç»“æœ: ç©º  âœ…ï¼ˆæ²¡æœ‰è¶…å–ï¼‰
```

---

### åœºæ™¯3ï¼šæ€§èƒ½å‹æµ‹

**é…ç½®ï¼š**
```
Thread Group:
  - Number of Threads: 1000
  - Ramp-up: 5
  - Loop: 1

ç§’æ€åˆ¸:
  - stock: 1000
```

**æ‰§è¡Œæµ‹è¯•ï¼š**

**è§‚å¯ŸæŒ‡æ ‡ï¼š**
```
Summary Report:
  - Throughput (TPS): è§‚å¯Ÿæ¯ç§’å¤„ç†è¯·æ±‚æ•°
  - Average Response Time: å¹³å‡å“åº”æ—¶é—´
  - 90% Line: 90%çš„è¯·æ±‚å“åº”æ—¶é—´
  - Error%: é”™è¯¯ç‡
```

**æ€§èƒ½åŸºå‡†ï¼ˆå‚è€ƒï¼‰ï¼š**
```
âœ… ä¼˜ç§€ï¼š
  - TPS: > 500
  - å¹³å‡å“åº”æ—¶é—´: < 100ms
  - 90% Line: < 200ms

âš ï¸ ä¸€èˆ¬ï¼š
  - TPS: 200-500
  - å¹³å‡å“åº”æ—¶é—´: 100-500ms
  - 90% Line: 200-1000ms

âŒ è¾ƒå·®ï¼š
  - TPS: < 200
  - å¹³å‡å“åº”æ—¶é—´: > 500ms
  - 90% Line: > 1000ms
```

---

## ğŸ“Š ç»“æœåˆ†æ

### 1. æŸ¥çœ‹ Summary Report

**å…³é”®æŒ‡æ ‡ï¼š**

| æŒ‡æ ‡ | è¯´æ˜ | ç›®æ ‡ |
|------|------|------|
| Samples | æ€»è¯·æ±‚æ•° | - |
| Average | å¹³å‡å“åº”æ—¶é—´(ms) | < 100ms |
| Min | æœ€å°å“åº”æ—¶é—´(ms) | - |
| Max | æœ€å¤§å“åº”æ—¶é—´(ms) | < 1000ms |
| Std. Dev. | æ ‡å‡†å·® | è¶Šå°è¶Šç¨³å®š |
| Error% | é”™è¯¯ç‡ | æ ¹æ®åœºæ™¯åˆ¤æ–­ |
| Throughput | ååé‡(TPS) | > 500 |
| KB/sec | ç½‘ç»œå¸¦å®½ | - |

---

### 2. æŸ¥çœ‹ View Results Tree

**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**
```json
{
    "success": true,
    "data": 1234567890123456789  // è®¢å•ID
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "success": false,
    "errorMsg": "åº“å­˜ä¸è¶³ï¼"
}
```

```json
{
    "success": false,
    "errorMsg": "æ¯äººé™è´­ä¸€å¼ ï¼"
}
```

---

### 3. éªŒè¯æ•°æ®ä¸€è‡´æ€§

**SQLéªŒè¯è„šæœ¬ï¼š**

```sql
-- 1. æŸ¥è¯¢è®¢å•æ€»æ•°
SELECT COUNT(*) AS order_count FROM tb_voucher_order WHERE voucher_id = 10;

-- 2. æŸ¥è¯¢å‰©ä½™åº“å­˜
SELECT stock FROM tb_seckill_voucher WHERE voucher_id = 10;

-- 3. éªŒè¯å…¬å¼ï¼šåˆå§‹åº“å­˜ = è®¢å•æ•° + å‰©ä½™åº“å­˜
-- å‡è®¾åˆå§‹åº“å­˜100ï¼Œè®¢å•æ•°åº”è¯¥ + åº“å­˜æ•° = 100

-- 4. æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤è´­ä¹°ï¼ˆä¸€äººä¸€å•ï¼‰
SELECT user_id, COUNT(*) as buy_count 
FROM tb_voucher_order 
WHERE voucher_id = 10 
GROUP BY user_id 
HAVING buy_count > 1;
-- ç»“æœåº”è¯¥ä¸ºç©º

-- 5. æ£€æŸ¥æ˜¯å¦è¶…å–
SELECT * FROM tb_seckill_voucher WHERE voucher_id = 10 AND stock < 0;
-- ç»“æœåº”è¯¥ä¸ºç©º
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ‰€æœ‰è¯·æ±‚éƒ½è¿”å›401

**åŸå› ï¼š** Tokenæ— æ•ˆæˆ–æœªç™»å½•

**è§£å†³ï¼š**
1. æ£€æŸ¥ `HTTP Header Manager` æ˜¯å¦æ·»åŠ  `authorization`
2. æ£€æŸ¥ `CSV Data Set` é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆï¼ˆRedisä¸­æ˜¯å¦å­˜åœ¨ï¼‰

**æµ‹è¯•tokenæ˜¯å¦æœ‰æ•ˆï¼š**
```
GET http://localhost:8081/user/me
Headers:
  authorization: your-token-here
```

---

### Q2: æ‰€æœ‰è¯·æ±‚éƒ½è¿”å›"æ¯äººé™è´­ä¸€å¼ "

**åŸå› ï¼š** æ‰€æœ‰çº¿ç¨‹ä½¿ç”¨åŒä¸€ä¸ªtoken

**è§£å†³ï¼š**
1. å‡†å¤‡å¤šä¸ªç”¨æˆ·token
2. CSV Data Set è®¾ç½® `Sharing mode: All threads`
3. ç¡®ä¿CSVæ–‡ä»¶æœ‰è¶³å¤Ÿå¤šçš„token

---

### Q3: æ•°æ®åº“æœ‰è¶…å–ï¼ˆstockä¸ºè´Ÿæ•°ï¼‰

**åŸå› ï¼š** ä¹è§‚é”å¤±æ•ˆ

**æ£€æŸ¥ï¼š**
1. ç¡®è®¤SQLæ˜¯å¦æ­£ç¡®ï¼š
```java
.setSql("stock = stock - 1")
.eq("voucher_id", voucherId)
.gt("stock", 0)  // â† å¿…é¡»æœ‰è¿™ä¸ªæ¡ä»¶
```

2. æ£€æŸ¥æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«

---

### Q4: æˆåŠŸç‡å¤ªä½ï¼ˆå¤§é‡"åº“å­˜ä¸è¶³"ï¼‰

**åŸå› ï¼š** ä¹è§‚é”å¤±è´¥ç‡é«˜ï¼ˆæ­£å¸¸ç°è±¡ï¼‰

**è¯´æ˜ï¼š**
- ä¹è§‚é”åœ¨é«˜å¹¶å‘ä¸‹ä¼šæœ‰è¾ƒé«˜å¤±è´¥ç‡
- å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°ï¼Œåªæœ‰ä¸€ä¸ªæˆåŠŸ
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œ**ä¸æ˜¯bug**

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨Redisé¢„å‡åº“å­˜ï¼ˆä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼‰
2. æ·»åŠ é‡è¯•æœºåˆ¶
3. ä½¿ç”¨åˆ†æ®µåº“å­˜

---

### Q5: æ€§èƒ½ä¸å¦‚é¢„æœŸï¼ˆTPSå¾ˆä½ï¼‰

**å¯èƒ½åŸå› ï¼š**
1. æ•°æ®åº“æ€§èƒ½ç“¶é¢ˆï¼ˆè¿æ¥æ± ã€ç´¢å¼•ï¼‰
2. äº‹åŠ¡é”ç«äº‰ï¼ˆsynchronizedå—ï¼‰
3. ç½‘ç»œå»¶è¿Ÿ

**ä¼˜åŒ–å»ºè®®ï¼š**
1. å¢åŠ æ•°æ®åº“è¿æ¥æ± å¤§å°
2. æ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼ˆvoucher_id, user_idï¼‰
3. ä½¿ç”¨Redisç¼“å­˜
4. å¼‚æ­¥å¤„ç†è®¢å•

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å¯¹æ¯”

### å½“å‰ç‰ˆæœ¬ï¼ˆä¹è§‚é”ï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… é˜²æ­¢è¶…å–
- âœ… å®ç°ç®€å•
- âœ… æ— éœ€Redisåˆ†å¸ƒå¼é”

**ç¼ºç‚¹ï¼š**
- âŒ é«˜å¹¶å‘ä¸‹å¤±è´¥ç‡é«˜
- âŒ æ•°æ®åº“å‹åŠ›å¤§
- âŒ TPSå—é™äºæ•°æ®åº“æ€§èƒ½

**æµ‹è¯•ç»“æœï¼ˆå‚è€ƒï¼‰ï¼š**
```
å¹¶å‘: 1000
åº“å­˜: 100
æˆåŠŸ: 100
å¤±è´¥: 900  â† å¤±è´¥ç‡90%ï¼ˆä¹è§‚é”å†²çªï¼‰
TPS: ~200-300
å¹³å‡å“åº”æ—¶é—´: 50-100ms
```

---

### ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆRedisé¢„å‡åº“å­˜ï¼‰

**æ”¹è¿›ç‚¹ï¼š**
- âœ… Redisé¢„å‡åº“å­˜ï¼ˆç§’çº§å“åº”ï¼‰
- âœ… å‡å°‘æ•°æ®åº“å‹åŠ›
- âœ… æé«˜æˆåŠŸç‡

**é¢„æœŸç»“æœï¼š**
```
å¹¶å‘: 1000
åº“å­˜: 100
æˆåŠŸ: 100
å¤±è´¥: 900  â† å¤±è´¥ç‡90%ï¼ˆåº“å­˜ä¸è¶³ï¼Œè€Œéé”å†²çªï¼‰
TPS: ~1000-2000  â† æå‡5-10å€
å¹³å‡å“åº”æ—¶é—´: 10-20ms  â† å“åº”æ—¶é—´é™ä½5å€
```

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´ï¼š** 2025-10-22

**æµ‹è¯•ç›®æ ‡ï¼š** éªŒè¯ç§’æ€åŠŸèƒ½çš„è¶…å–é—®é¢˜å’Œå¹¶å‘æ€§èƒ½

**æµ‹è¯•ç¯å¢ƒï¼š**
- JDKç‰ˆæœ¬ï¼š1.8
- Spring Bootç‰ˆæœ¬ï¼š2.7.4
- æ•°æ®åº“ï¼šMySQL 5.7
- Redisç‰ˆæœ¬ï¼š6.2

**æµ‹è¯•æ•°æ®ï¼š**
- ç§’æ€åˆ¸IDï¼š10
- åˆå§‹åº“å­˜ï¼š100
- æµ‹è¯•ç”¨æˆ·ï¼š200ä¸ª

**æµ‹è¯•åœºæ™¯ï¼š**

| åœºæ™¯ | çº¿ç¨‹æ•° | Ramp-up | é¢„æœŸç»“æœ | å®é™…ç»“æœ | æ˜¯å¦é€šè¿‡ |
|------|--------|---------|---------|---------|----------|
| ä¸€äººä¸€å• | 100 | 1s | æˆåŠŸ1ï¼Œå¤±è´¥99 | æˆåŠŸ1ï¼Œå¤±è´¥99 | âœ… |
| è¶…å–éªŒè¯ | 200 | 1s | æˆåŠŸ100ï¼Œå¤±è´¥100 | æˆåŠŸ100ï¼Œå¤±è´¥100 | âœ… |
| æ€§èƒ½å‹æµ‹ | 1000 | 5s | TPS>500 | TPS=300 | âš ï¸ |

**æ€§èƒ½æŒ‡æ ‡ï¼š**
```
å¹³å‡å“åº”æ—¶é—´ï¼š80ms
90% Lineï¼š150ms
TPSï¼š300
é”™è¯¯ç‡ï¼š90%ï¼ˆä¹è§‚é”å†²çªï¼‰
```

**æ•°æ®ä¸€è‡´æ€§éªŒè¯ï¼š**
```sql
-- è®¢å•æ€»æ•°
SELECT COUNT(*) FROM tb_voucher_order WHERE voucher_id = 10;
ç»“æœï¼š100  âœ…

-- å‰©ä½™åº“å­˜
SELECT stock FROM tb_seckill_voucher WHERE voucher_id = 10;
ç»“æœï¼š0  âœ…

-- è¶…å–æ£€æŸ¥
SELECT * FROM tb_seckill_voucher WHERE stock < 0;
ç»“æœï¼šç©º  âœ…

-- é‡å¤è´­ä¹°æ£€æŸ¥
SELECT user_id, COUNT(*) FROM tb_voucher_order WHERE voucher_id = 10 GROUP BY user_id HAVING COUNT(*) > 1;
ç»“æœï¼šç©º  âœ…
```

**ç»“è®ºï¼š**
1. âœ… ä¹è§‚é”æˆåŠŸé˜²æ­¢è¶…å–
2. âœ… ä¸€äººä¸€å•æ ¡éªŒæ­£å¸¸
3. âš ï¸ æ€§èƒ½æœ‰å¾…æå‡ï¼ˆå»ºè®®ä½¿ç”¨Redisé¢„å‡åº“å­˜ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

1. **Redisé¢„å‡åº“å­˜** - å‡å°‘æ•°æ®åº“å‹åŠ›
2. **å¼‚æ­¥ä¸‹å•** - æå‡å“åº”é€Ÿåº¦
3. **Luaè„šæœ¬** - ä¿è¯åŸå­æ€§
4. **æ¶ˆæ¯é˜Ÿåˆ—** - å‰Šå³°å¡«è°·

---

æ­å–œï¼ğŸ‰ ç°åœ¨ä½ å¯ä»¥å¼€å§‹å‹æµ‹äº†ï¼

